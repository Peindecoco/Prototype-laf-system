<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Report Lost Item</title>

    <link rel="icon" type="image/x-icon" href="assets/web_icon.png">
    <link rel="stylesheet" href="common.css">
    <link rel="stylesheet" href="report_sheet.css">
</head>
<body>

<div class="container">

    <header>
        <img src="assets/feu_hs_logo.png" alt="" class="title-img">
        <img src="assets/feu_hs_laf.png" alt="" class="title-text">
    </header>

    <nav>
        <a href="index.html"><span class="gold-text">01</span> HOME</a>
        <a href="report.html" class="nav-active"><span>02</span> REPORT</a>
        <a href="#"><span class="gold-text">03</span> HELP</a>
    </nav>

    <div class="main">
        <div class="report-sheet">
            <h1>Report a Lost Item</h1>

             <form class="report-form" id="reportForm" enctype="multipart/form-data">
                <input type="text" name="itemName" placeholder="Item name" required>
                <input type="text" name="description" placeholder="Description / exact contents" required>
                <input type="text" name="locationLost" placeholder="Where was it lost?" required>
                <input type="text" name="color" placeholder="Color">
                <input type="text" name="size" placeholder="Size">
                <input type="text" name="shape" placeholder="Shape">
                <input type="text" name="contact" placeholder="Your contact info" required>
                <input type="text" name="secretDetail" placeholder="Secret detail (only you know)" required>
                <input type="file" name="image" accept="image/*">

                <button type="submit" class="btn">Submit</button>
            </form>

            <p id="message"></p>
            <div id="matches"></div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <p>&copy; 2026 FEU High School Lost and Found</p>
            <p>Powered by FEU Tech Team</p>
        </div>
    </footer>

</div>

<script>
const form = document.getElementById('reportForm');
const message = document.getElementById('message');
    const matchesEl = document.getElementById('matches');

function renderMatches(matches) {
    matchesEl.innerHTML = '';
    if (!matches.length) return;

    const title = document.createElement('p');
    title.innerHTML = '<strong>Possible matches in the gallery:</strong>';
    matchesEl.appendChild(title);

    const list = document.createElement('ul');
    matches.forEach(match => {
        const item = document.createElement('li');
        const scorePercent = Math.round((match.score || 0) * 100);
        item.innerHTML = `${match.name || 'Unnamed item'} â€” ${scorePercent}% match (${match.locationFound || 'Unknown location'})`;
        list.appendChild(item);
    });

    const guide = document.createElement('p');
    guide.innerHTML = 'Please check <a href="index.html">the gallery</a> and claim if one looks like yours.';

    matchesEl.appendChild(list);
    matchesEl.appendChild(guide);
}

form.addEventListener('submit', async (e) => {
    e.preventDefault();
    matchesEl.innerHTML = '';

    const formData = new FormData(form);

    try {
        const res = await fetch('/api/report', {    
            method: 'POST',
            body: formData
        });

        const result = await res.json();

        if (!res.ok || result.error) {
            message.textContent = result.error || 'Error submitting report.';
            message.style.color = 'red';
            return;
        }

        message.style.color = 'green';

        if (result.hasMatches && Array.isArray(result.matches) && result.matches.length) {
            message.textContent = 'Report submitted. We found possible matches in the gallery.';
            renderMatches(result.matches);
        } else {
            message.textContent = 'Report submitted. There are no matching items in the gallery yet. Your item is now reported; please wait for further updates from the admin.';
        }

        form.reset();

    } catch (err) {
        message.textContent = 'Error submitting report.';
        message.style.color = 'red';
    }
});
</script>

</body>
</html>
